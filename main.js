!function(){"use strict";function t(t,e,o){const s=`\n        <div class="col__card card" data-cardId ="${e}">\n            <button class="card__delete d_none">X</button>\n            <div class="card__text"> ${t}</div>\n            <button class="card__subBtn"></button>\n            <span class="card__subMenu d_none">\n                <label class="subMenu__item">\n                    <button class="like"></button>\n                    <span class="quantity">1</span>\n                </label>\n                <label class="subMenu__item">\n                    <button class="unlike"></button>\n                    <span class="quantity">2</span>\n                </label>\n                <label class="subMenu__item">\n                    <button class="message"></button>\n                    <span class="quantity">3</span>\n                </label>\n            </span>\n        </div>\n        `;document.querySelector(`[data-name="${o}"]`).querySelector(".col__content").insertAdjacentHTML("beforeend",s)}const e=document.querySelector(".container");new class{constructor(t){this.container=t,this.data={todo:[],progress:[],done:[]},this.colHeader=this.container.querySelector(".col__header"),this.colContent=this.container.querySelector(".col__content"),this.footers=Array.from(this.container.querySelectorAll(".col__footer")),this.actualElement=void 0,this.colContentEl=null,this.x=null,this.y=null,this.count=0,this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this)}init(){this.footers.forEach((t=>{t.addEventListener("click",(t=>this.openMessageBox(t)))})),this.redraw()}onMouseUp(t){this.cloneActualElement.classList.remove("ghost"),this.actualElement.remove(),this.actualElement=this.cloneActualElement,this.cloneActualElement=null,this.actualElement.classList.remove("dragged");const e=this.actualElement.getAttribute("data-cardId");this.hoverCard(e);const o=this.colOld.closest(".trello__col"),s=o.getAttribute("data-name");t.target.closest(".trello__col")?this.columNewAttribute=t.target.closest(".trello__col").getAttribute("data-name"):this.columNewAttribute=o.getAttribute("data-name");const n=Array.from(this.actualElement.closest(".trello__col").querySelectorAll(".col__card")),a=this.data[s].findIndex((t=>t.id==e));this.data[s].splice(a,1);const l=n.findIndex((t=>t.getAttribute("data-cardId")==e)),c=this.actualElement.querySelector(".card__text").textContent.trim();this.data[this.columNewAttribute].splice(l,0,{id:e,text:c}),this.actualElement=void 0,this.actualElement&&null!==this.cloneActualElement||(document.body.style.cursor="auto"),this.saveData(),document.documentElement.removeEventListener("mouseup",this.onMouseUp),document.documentElement.removeEventListener("mousemove",this.onMouseMove)}onMouseMove(t){if(this.actualElement&&(this.actualElement.style.top=t.pageY-this.y+"px",this.actualElement.style.left=t.pageX-this.x+"px"),!this.actualElement)return;const e=t.target,o=t.target.closest(".col__content");if(t.target.closest(".col__content")){0==t.target.closest(".col__content").children.length&&o.append(this.cloneActualElement),t.target.closest(".col__card")&&t.target.closest(".col__card").getAttribute("data-cardId")!==this.actualElement.getAttribute("data-cardId")&&o.insertBefore(this.cloneActualElement,t.target.closest(".col__card"));const e=t.target.closest(".col__content").lastElementChild,{bottom:s}=e.getBoundingClientRect();t.pageY>s&&o.append(this.cloneActualElement)}e.closest(".col__header")&&(this.colContentEl=e.closest(".trello__col").querySelector(".col__content"),this.colContentEl.insertBefore(this.cloneActualElement,this.colContentEl.firstElementChild)),e.closest(".col__footer")&&(this.colContentEl=e.closest(".trello__col").querySelector(".col__content"),this.colContentEl.append(this.cloneActualElement)),e.closest(".trello__content")&&!e.classList.contains("trello__content")||this.colOld.append(this.cloneActualElement)}onMouseDown(t){if(t.preventDefault(),t.target.classList.contains("card__delete")||t.target.classList.contains("card__subBtn"))this.clickButtomForm(t);else if(!t.target.classList.contains("card__text")&&t.target.closest(".col__card")){this.actualElement=t.target.closest(".col__card"),this.colOld=this.actualElement.closest(".col__content"),this.cloneActualElement=this.actualElement.cloneNode(!0);const e=this.actualElement.getBoundingClientRect();this.x=t.clientX-e.left,this.y=t.clientY-e.top,this.cloneActualElement.classList.add("ghost"),this.actualElement.classList.add("drag"),this.actualElement.style.width=e.width-20+"px",document.body.style.cursor="grabbing",document.documentElement.addEventListener("mouseup",this.onMouseUp),document.documentElement.addEventListener("mousemove",this.onMouseMove)}}hoverCard(t){const e=document.querySelector(`[data-cardId='${t}']`);e.addEventListener("mouseover",(t=>this.onhoverCard(t))),e.addEventListener("mouseout",(t=>this.outhoverCard(t))),e.addEventListener("mousedown",(t=>this.onMouseDown(t)))}openMessageBox(e){e.preventDefault();const o=e.target;if(e.target.closest(".col__add")&&(this.colAdd=e.target.closest(".col__add")),this.footer=e.currentTarget.closest(".col__footer"),this.form=this.footer.querySelector("form"),this.addTextarea=this.form.querySelector(".add__textarea"),this.addTextarea.addEventListener("focus",this.removeErrorForm),e.target.closest(".col__add")&&this.dNone(this.colAdd,this.form),o===this.footer.querySelector(".add__btn")&&(this.removeErrorForm(),this.dNone(this.form,this.colAdd)),o===this.footer.querySelector(".add__button")){const o=this.addTextarea.value.trim();o.length>0?(this.column=e.currentTarget.closest(".trello__col").getAttribute("data-name"),t(o,this.count,this.column),this.hoverCard(this.count),this.data[this.column].push({id:this.count,text:o}),this.count+=1,this.dNone(this.form,this.colAdd),this.saveData()):this.form.insertAdjacentHTML("beforeend",'\n        <div class="errorForm">\n            <p class="text">Введите пожалуйста текст!<p>\n        </div>\n        ')}}dNone(t,e){t.classList.add("d_none"),e.classList.remove("d_none"),e.classList.contains("d_none")||(this.addTextarea.value="")}onhoverCard(t){const e=t.currentTarget.querySelector("button.d_none");null!==e&&e.classList.remove("d_none")}outhoverCard(t){document.querySelectorAll(".card__delete").forEach((t=>{t.classList.add("d_none")}));const e=t.currentTarget,o=e.querySelector(".card__delete"),s=e.classList.contains("d_none");s&&null!==s||o.classList.add("d_none")}clickButtomForm(t){const e=t.target,o=e.classList.contains("card__delete"),s=e.classList.contains("card__subBtn"),n=t.currentTarget;if(o){const e=n.classList.contains("col__card"),o=t.currentTarget.closest(".trello__col").getAttribute("data-name"),s=t.currentTarget.closest(".col__card").getAttribute("data-cardId");if(e){const t=this.data[o].findIndex((t=>t.id==s));return this.data[o].splice(t,1),n.remove(),void this.saveData()}}if(s){const t=n.querySelector(".card__subMenu");t.classList.contains("d_none")?t.classList.remove("d_none"):t.classList.add("d_none")}}removeErrorForm(){this.form.querySelector(".errorForm")&&this.form.querySelector(".errorForm").remove()}saveData(){localStorage.setItem("data",JSON.stringify(this.data))}loadData(){this.dataElem=JSON.parse(localStorage.getItem("data"))}redraw(){this.loadData(),null!==this.dataElem&&["todo","progress","done"].forEach((e=>{let o=document.querySelectorAll("[data-cardId]").length;this.dataElem[e].forEach((s=>{o=document.querySelectorAll("[data-cardId]").length,t(s.text,o,e),this.hoverCard(o),this.data[e].push({id:o,text:s.text}),this.count+=1}))}))}}(e).init()}();